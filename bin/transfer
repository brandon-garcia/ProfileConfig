#!/usr/bin/expect -f
set timeout -1

set src [lindex $argv 0]
set dest [lindex $argv 1]

if {[regexp {^([^:]*):(.*)$} $src -> host file]} {
    set ssh_host $host
} elseif {[regexp {^([^:]*):(.*)$} $dest -> host file]} {
    set ssh_host $host
} else {
    set ssh_host "localhost"
}


spawn bash
expect -re {[^ ] $}
set auth_data [split [exec auth -h $ssh_host] "\n"]
send "exit\r"
set ssh_pass  [lindex $auth_data 0]

spawn scp $src $dest
expect {
    {assword: } { exp_send "$ssh_pass\r" ; exp_continue }
    -re {[$âˆ«] } { send_user "\n"                        }
}
